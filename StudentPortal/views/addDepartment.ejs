<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phòng ban</title>
    <link href="https://releases.transloadit.com/uppy/v1.26.1/uppy.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="//use.fontawesome.com/releases/v5.7.2/css/all.css">
    <%- include partial/cdn.ejs %>
    <style>
        ul.ks-cboxtags {
    list-style: none;
    padding: 20px;
}
ul.ks-cboxtags li{
  display: inline;
}
ul.ks-cboxtags li label{
    display: inline-block;
    background-color: rgba(255, 255, 255, .9);
    border: 2px solid rgba(139, 139, 139, .3);
    color: #adadad;
    border-radius: 25px;
    white-space: nowrap;
    margin: 3px 0px;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    transition: all .2s;
}
ul.ks-cboxtags li label {
    padding: 8px 12px;
    cursor: pointer;
}
ul.ks-cboxtags li label::before {
    display: inline-block;
    font-style: normal;
    font-variant: normal;
    text-rendering: auto;
    -webkit-font-smoothing: antialiased;
    font-family: "Font Awesome 5 Free";
    font-weight: 900;
    font-size: 12px;
    padding: 2px 6px 2px 2px;
    content: "\f067";
    transition: transform .3s ease-in-out;
}
ul.ks-cboxtags li input[type="checkbox"]:checked + label::before {
    content: "\f00c";
    transform: rotate(-360deg);
    transition: transform .3s ease-in-out;
}
ul.ks-cboxtags li input[type="checkbox"]:checked + label {
    border: 2px solid #1bdbf8;
    background-color: #12bbd4;
    color: #fff;
    transition: all .2s;
}
ul.ks-cboxtags li input[type="checkbox"] {
  display: absolute;
}
ul.ks-cboxtags li input[type="checkbox"] {
  position: absolute;
  opacity: 0;
}
ul.ks-cboxtags li input[type="checkbox"]:focus + label {
  border: 2px solid #e9a1ff;
}
    </style>
</head>

<body class="addDepartment">
    <%- include partial/responsiveMenu.ejs %>
    <%- include partial/topbar.ejs %>
    <%- include partial/header-leftbar.ejs %>
    <%- include partial/header-rightbar.ejs %>
    <div class="container mx-auto">
        <div class="gap2 pr-2 pl-2">
            
            <div aria-label="breadcrumb" class="mt-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="../">Trang chủ</a></li>
                    <li class="breadcrumb-item"><a href="../department">Danh sách phòng ban</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Thêm phòng ban</li>
                </ol>
            </div>
            <div class="signup-content">
                <div class="row">
                    <div class="signup-image col-sm-5 ">
                        <figure><img src="/images/pexels-mateusz-dach-2811648.jpg" alt="sing up image"></figure>

                    </div>
                    <div class="signup-form col-sm-7 pr-5 pl-5">
                        <h2 class="form-title">Tạo mới phòng ban</h2>

                        <form method="POST" class="register-form" id="register-form" autocomplete="off">
                            <div class="form-group">
                                <label for="username"><i class="far fa-user"></i></label>
                                <input type="text" name="username" id="username" placeholder="Tên đăng nhập">
                            </div>
                            <div class="form-group">
                                <label for="pass"><i class="fas fa-lock"></i></label>
                                <input type="password" name="pass" id="pass" placeholder="Mật khẩu">
                            </div>
                            <div class="form-group">
                                <label for="re-pass"><i class="fas fa-lock"></i></label>
                                <input type="password" name="re_pass" id="re_pass" placeholder="Xác nhận mật khẩu">
                            </div>
                            <div class="form-group">
                                <label for="name"><i class="fas fa-file-signature"></i></label>
                                <input type="text" name="name" id="name" placeholder="Tên phòng">
                            </div>
                            <div class="form-group">
                                <label for="email"><i class="fas fa-code-branch"></i></label>
                                <input type="text" name="maphong" id="maphong" placeholder="Mã phòng">
                            </div>

                            <div id="drag-drop-area"></div>
                            
                            <input type="hidden" name="urlImage"  id="urlImage"/>
                            <div class="row">
                                <h4 class="col-sm-12 p-0 pt-2 pb-2">Permission</h4>
                                <ul class="ks-cboxtags">
                                    
                                    <% department.forEach(function(item){ %>
                                        <li>
                                            <input type="checkbox" id="<%= item.id %>" value="<%= item.type %>">
                                            <label for="<%= item.id %>"><%= item.name %></label>
                                        </li>
                                    <% }) %>
                                </ul>

                            </div>
                            
                            <div class="collapse mt-2" id="myCollapsible">
                                <div class="alert alert-success" role="alert">
                                    
                                </div>
                            </div>
                        </form>
                        <button id="register" type="submit" class="btn btn-outline-primary" >Register</button>
                        
                    </div>  
                   
                </div>
            </div>
        </div>

    </div>
</body>
<script src="https://releases.transloadit.com/uppy/v1.26.1/uppy.min.js"></script>
<script src="/javascripts/main.js"></script>
<script>
      // addDepartment
if($(".addDepartment")[0]){
    $.ajaxSetup({
        traditional: true
    });
    var uppyDepartment = Uppy.Core({
            restrictions: {
                maxFileSize: 3145728,
                maxNumberOfFiles: 1,
                minNumberOfFiles: 1,
                allowedFileTypes: ["image/*"]
            }
        })
        .use(Uppy.Dashboard, {
            trigger: '#register',
            inline: true,
            target: '#drag-drop-area',
            replaceTargetContent: true,
            showProgressDetails: true,
            note: 'Images and video only 1 file, up to 3MB',
            height: 300,
            metaFields: [{
                id: 'caption',
                name: 'Caption',
                placeholder: 'describe what the image is about'
            }],
            hideUploadButton: false
        })
    uppyDepartment.on('file-added', (file) => {
        console.log(file);
        uppy.setFileMeta(file.meta.id, {
            caption: file.name
        });
    });
    uppyDepartment.use(Uppy.XHRUpload, {
        id: 'XHRUpload',
        endpoint: `https://xhr-server.herokuapp.com/upload`,
        method: 'POST',
        formData: true,
        fieldName: 'my_fieldName',
        metaFields: ['caption'],
    });
    uppyDepartment.on('upload-success', (file, response) => {
        $('.addDepartment #urlImage').val(response.uploadURL)
        
    });
    $(".addDepartment #register").click(function () {
        $(".addDepartment .register-form").submit()
    })
    $(".addDepartment .register-form").submit(e => {
        e.preventDefault();
        console.log(123)
        let department = []
        $(".addDepartment input:checkbox:checked").each(function () {
            department.push($(this).val());
        });
        let user = {
            username: $('.addDepartment #username').val(),
            pass: $('.addDepartment #pass').val(),
            re_pass: $('.addDepartment #re_pass').val(),
            name: $('.addDepartment #name').val(),
            maphong: $('.addDepartment #maphong').val(),
            urlImage: $('.addDepartment #urlImage').val(),
            department: department
        }
        $.post("", user)
            .done(function (res) {
                if (res.success) {
                    $(".addDepartment .alert").removeClass("alert-danger")
                    $(".addDepartment .alert").addClass("alert-success")
                    $(".addDepartment .alert").text(res.mess)
                    $('.addDepartment #myCollapsible').collapse('show')
                    $('.addDepartment input').val("")
                    uppyDepartment.reset()
                } else {
                    $(".addDepartment .alert").removeClass("alert-success")
                    $(".addDepartment .alert").addClass("alert-danger")
                    $(".addDepartment .alert").text(res.mess)
                    $('.addDepartment #myCollapsible').collapse('show')
                }
            });
        $('.addDepartment input').on("keypress change ", () => {
            $('.addDepartment #myCollapsible').collapse('hide')
        })
    })
}
</script>
</html>